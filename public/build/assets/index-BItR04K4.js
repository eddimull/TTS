import{_ as N,r as _,o as d,b as c,F as v,k as g,t as m,d as D,a as t,w as l,f as F,h as C,a7 as x,c as R,e as r,a8 as z}from"./app-Dcv1srkc.js";const I={data(){return{payments:[],loading:!0,error:!1,errorMessage:""}},created(){this.getPayments()},methods:{getPayments(){this.payments=this.$page.props.payments},gotoPayments(p){const a=p.data.proposal;window.location="/proposals/"+a.key+"/payments"}}},U={key:0};function M(p,a,s,n,e,f){const i=_("Column"),y=_("DataTable");return d(),c("div",null,[(d(!0),c(v,null,g(e.payments,(P,k)=>(d(),c("div",{key:k,class:"card my-4"},[e.payments.length>0?(d(),c("div",U," Payments for "+m(P.name),1)):D("",!0),t(y,{value:P.payments,"striped-rows":"","row-hover":"",paginator:!0,rows:20,class:"cursor-pointer",onRowClick:f.gotoPayments},{default:l(()=>[t(i,{field:"proposal.name",header:"Contract Name",sortable:!0}),t(i,{field:"name",header:"Payment Name",sortable:!0}),t(i,{field:"formattedPaymentAmount",header:"Amount",sortable:!0},{body:l(u=>[F(" $"+m(u.data.formattedPaymentAmount),1)]),_:1}),t(i,{field:"formattedPaymentDate",header:"Payment Date",sortable:!0})]),_:2},1032,["value","onRowClick"])]))),128))])}const L=N(I,[["render",M]]),O={components:{Payments:L},data(){return{completedProposals:[],paidProposalFilter:null,unpaidProposalFilter:null,basicOptions:{plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}}},computed:{revenue(){const p=[];for(const n in this.completedProposals){const e={name:this.completedProposals[n].name};var a=[...this.completedProposals[n].completed_proposals].map(function(i){return[C(i.date).format("YYYY"),parseFloat(i.price)]}),s=a.reduce(function(i,y,P,k){var u=i[y[0]];return i[y[0]]=u?u+y[1]:y[1],i},{});e.aggregatedRevenue=s,p.push(e)}return p}},created(){this.completedProposals=this.$page.props.completedProposals,this.parseProposals(),this.initializedPaidProposalFilter(),this.initializedunPaidProposalFilter()},methods:{moneyFormat(p){var a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});return a.format(p)},getStats(p,a){const s=parseFloat(p.replace(/,/g,"")).toFixed(2)/parseFloat(a).toFixed(2)*100;let n="red";switch(!0){case s<10:n="#ff2d03";break;case s<20:n="#ff7d03";break;case s<30:n="#ffc803";break;case s<40:n="#fff203";break;case s<50:n="#d9ff03";break;case s<60:n="#c0ff03";break;case s<70:n="#afff03";break;case s<80:n="#92ff03";break;case s<90:n="#3eff03";break}return[{width:s+"%"},{background:n}]},gotoPayments(p){const a=p.data;window.location="/proposals/"+a.key+"/payments"},initializedPaidProposalFilter(){this.paidProposalFilter={global:{value:null,matchMode:x.CONTAINS}}},initializedunPaidProposalFilter(){this.unpaidProposalFilter={global:{value:null,matchMode:x.CONTAINS}}},parseProposals(){const p={};for(const a in this.completedProposals){const s=this.completedProposals[a].completed_proposals,n={labels:["January","February","March","April","May","June","July","August","September","October","November","December"],datasets:[{label:"Paid",data:Array(12).fill(0),fill:!1,borderColor:"#42A5F5",tension:.4},{label:"Unpaid",data:Array(12).fill(0),fill:!1,borderColor:"#FFA726",tension:.4}]};s.forEach(e=>{const f=C(e.date).format("M")-1;n.datasets[e.paid?0:1].data[f]+=parseInt(e.price)}),this.completedProposals[a].data=n,this.completedProposals[a].unpaid=s.filter(e=>{if(!e.paid)return e}),this.completedProposals[a].paid=s.filter(e=>{if(e.paid||e.amountLeft=="0.00")return e})}return p}}},B=r("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Finances ",-1),E={class:"underline text-2xl"},Y={class:"card"},J={class:"card"},j={class:"p-d-flex p-jc-between"},K={class:"p-input-icon-left"},q=r("i",{class:"pi pi-search"},null,-1),G={class:"border flex flex-row relative p-2"},H={class:"z-50"},Q={class:"card"},W={class:"p-d-flex p-jc-between"},X={class:"p-input-icon-left"},Z=r("i",{class:"pi pi-search"},null,-1),$={key:0},ee=r("i",{class:"pi pi-check"},null,-1),te=r("div",null,[r("a",{href:"/finances/invoices",class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"},"Invoices")],-1);function ae(p,a,s,n,e,f){const i=_("TabPanel"),y=_("Chart"),P=_("Button"),k=_("InputText"),u=_("Column"),w=_("DataTable"),T=_("Payments"),S=_("TabView"),V=_("Container"),A=_("Layout");return d(),R(A,null,{header:l(()=>[B]),default:l(()=>[t(V,null,{default:l(()=>[t(S,null,{default:l(()=>[t(i,{header:"Revenue for year"},{default:l(()=>[(d(!0),c(v,null,g(f.revenue,h=>(d(),c("div",{key:h.name},[r("h2",E,m(h.name),1),(d(!0),c(v,null,g(h.aggregatedRevenue,(b,o)=>(d(),c("ul",{key:o},[r("li",null,m(o)+": "+m(f.moneyFormat(b)),1)]))),128))]))),128))]),_:1}),t(i,{header:"Paid/Unpaid"},{default:l(()=>[(d(!0),c(v,null,g(e.completedProposals,(h,b)=>(d(),c("div",{key:b,class:"card my-4"},[r("div",Y,[r("h5",null,m(h.name),1),t(y,{type:"line",data:h.data,options:e.basicOptions},null,8,["data","options"])])]))),128))]),_:1}),t(i,{header:"Unpaid Contracts"},{default:l(()=>[(d(!0),c(v,null,g(e.completedProposals,(h,b)=>(d(),c("div",{key:b,class:"card my-4"},[r("div",J,[r("h5",null,m(h.name),1),t(w,{filters:e.unpaidProposalFilter,"onUpdate:filters":a[2]||(a[2]=o=>e.unpaidProposalFilter=o),value:h.unpaid,"striped-rows":"","row-hover":"","responsive-layout":"scroll","selection-mode":"single",onRowClick:f.gotoPayments},{header:l(()=>[r("div",j,[t(P,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:a[0]||(a[0]=o=>f.initializedunPaidProposalFilter())}),r("span",K,[q,t(k,{modelValue:e.unpaidProposalFilter.global.value,"onUpdate:modelValue":a[1]||(a[1]=o=>e.unpaidProposalFilter.global.value=o),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:l(()=>[F(" No Records found. Click 'new' to create one. ")]),default:l(()=>[t(u,{field:"name",header:"Name",sortable:!0}),t(u,{field:"price",header:"Price",sortable:!0},{body:l(o=>[F(" $"+m(parseFloat(o.data.price).toFixed(2)),1)]),_:1}),t(u,{field:"amountPaid",header:"Paid",sortable:!0},{body:l(o=>[r("div",G,[r("div",H,m(o.data.amountPaid.replace(/,/g,""))+" / "+m(parseFloat(o.data.price).toFixed(2)),1),r("div",{class:"z-40 absolute top-0 left-0 h-full",style:z([{"min-width":"10px"},f.getStats(o.data.amountPaid,o.data.price)])},null,4)])]),_:1}),t(u,{field:"date",header:"Event Date",sortable:!0})]),_:2},1032,["filters","value","onRowClick"])])]))),128))]),_:1}),t(i,{header:"Paid Contracts"},{default:l(()=>[(d(!0),c(v,null,g(e.completedProposals,(h,b)=>(d(),c("div",{key:b,class:"card my-4"},[r("div",Q,[r("h5",null,m(h.name),1),t(w,{filters:e.paidProposalFilter,"onUpdate:filters":a[5]||(a[5]=o=>e.paidProposalFilter=o),value:h.paid,"striped-rows":"","row-hover":"","responsive-layout":"scroll","selection-mode":"single",onRowClick:f.gotoPayments},{header:l(()=>[r("div",W,[t(P,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:a[3]||(a[3]=o=>f.initializedPaidProposalFilter())}),r("span",X,[Z,t(k,{modelValue:e.paidProposalFilter.global.value,"onUpdate:modelValue":a[4]||(a[4]=o=>e.paidProposalFilter.global.value=o),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:l(()=>[F(" No Records found. Click 'new' to create one. ")]),default:l(()=>[t(u,{field:"name",header:"Name",sortable:!0}),t(u,{field:"price",header:"Price",sortable:!0},{body:l(o=>[F(" $"+m(parseFloat(o.data.price).toFixed(2)),1)]),_:1}),t(u,{field:"date",header:"Event Date",sortable:!0}),t(u,{field:"amountLeft",header:"Payment Overridden",sortable:!0},{body:l(o=>[o.data.amountLeft!=="0.00"&&o.data.paid?(d(),c("div",$,[ee,F(" Still Owed $"+m(o.data.amountLeft),1)])):D("",!0)]),_:1})]),_:2},1032,["filters","value","onRowClick"])])]))),128))]),_:1}),t(i,{header:"Invoices"},{default:l(()=>[te]),_:1}),t(i,{header:"Payments"},{default:l(()=>[r("div",null,[t(T)])]),_:1})]),_:1})]),_:1})]),_:1})}const le=N(O,[["render",ae]]);export{le as default};
