import{_ as N,r as _,o as c,b as u,F as v,k as g,t as f,d as D,a as t,w as o,f as F,h as C,a7 as x,c as R,e as l,a8 as z}from"./app-BMCubQSI.js";const I={data(){return{payments:[],loading:!0,error:!1,errorMessage:""}},created(){this.getPayments()},methods:{getPayments(){this.payments=this.$page.props.payments},gotoPayments(p){const e=p.data.proposal;window.location="/proposals/"+e.key+"/payments"}}},U={key:0};function M(p,e,d,i,s,n){const r=_("Column"),y=_("DataTable");return c(),u("div",null,[(c(!0),u(v,null,g(s.payments,(P,k)=>(c(),u("div",{key:k,class:"card my-4"},[s.payments.length>0?(c(),u("div",U," Payments for "+f(P.name),1)):D("",!0),t(y,{value:P.payments,"striped-rows":"","row-hover":"",paginator:!0,rows:20,class:"cursor-pointer",onRowClick:n.gotoPayments},{default:o(()=>[t(r,{field:"proposal.name",header:"Contract Name",sortable:!0}),t(r,{field:"name",header:"Payment Name",sortable:!0}),t(r,{field:"formattedPaymentAmount",header:"Amount",sortable:!0},{body:o(m=>[F(" $"+f(m.data.formattedPaymentAmount),1)]),_:1}),t(r,{field:"formattedPaymentDate",header:"Payment Date",sortable:!0})]),_:2},1032,["value","onRowClick"])]))),128))])}const B=N(I,[["render",M]]),L={components:{Payments:B},data(){return{completedProposals:[],paidProposalFilter:null,unpaidProposalFilter:null,basicOptions:{plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}}},computed:{revenue(){const p=[];for(const i in this.completedProposals){const s={name:this.completedProposals[i].name};var e=[...this.completedProposals[i].completed_proposals].map(function(r){return[C(r.date).format("YYYY"),parseFloat(r.price)]}),d=e.reduce(function(r,y,P,k){var m=r[y[0]];return r[y[0]]=m?m+y[1]:y[1],r},{});s.aggregatedRevenue=d,p.push(s)}return p}},created(){this.completedProposals=this.$page.props.completedProposals,this.parseProposals(),this.initializedPaidProposalFilter(),this.initializedunPaidProposalFilter()},methods:{moneyFormat(p){var e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});return e.format(p)},getStats(p,e){const d=parseFloat(p.replace(/,/g,"")).toFixed(2)/parseFloat(e).toFixed(2)*100;let i="red";switch(!0){case d<10:i="#ff2d03";break;case d<20:i="#ff7d03";break;case d<30:i="#ffc803";break;case d<40:i="#fff203";break;case d<50:i="#d9ff03";break;case d<60:i="#c0ff03";break;case d<70:i="#afff03";break;case d<80:i="#92ff03";break;case d<90:i="#3eff03";break}return[{width:d+"%"},{background:i}]},gotoPayments(p){const e=p.data;window.location="/proposals/"+e.key+"/payments"},initializedPaidProposalFilter(){this.paidProposalFilter={global:{value:null,matchMode:x.CONTAINS}}},initializedunPaidProposalFilter(){this.unpaidProposalFilter={global:{value:null,matchMode:x.CONTAINS}}},parseProposals(){for(const p in this.completedProposals){const e=this.completedProposals[p].completed_proposals,d=e[0].band.name,i={labels:["January","February","March","April","May","June","July","August","September","October","November","December"],datasets:[{label:"Paid",data:Array(12).fill(0),fill:!1,borderColor:"#42A5F5",tension:.4},{label:"Unpaid",data:Array(12).fill(0),fill:!1,borderColor:"#FFA726",tension:.4}]};e.forEach(n=>{const r=C(n.date).format("M")-1;i.datasets[n.paid?0:1].data[r]+=parseInt(n.price)});const s={completed_proposals:[...e],data:i,name:d,unpaid:e.filter(n=>!n.paid),paid:e.filter(n=>n.paid||n.amountLeft==="0.00")};this.completedProposals={...this.completedProposals,[p]:s}}}}},O=l("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Finances ",-1),E={class:"underline text-2xl"},Y={class:"card"},J={class:"card"},j={class:"p-d-flex p-jc-between"},K={class:"p-input-icon-left"},q=l("i",{class:"pi pi-search"},null,-1),G={class:"border flex flex-row relative p-2"},H={class:"z-50"},Q={class:"card"},W={class:"p-d-flex p-jc-between"},X={class:"p-input-icon-left"},Z=l("i",{class:"pi pi-search"},null,-1),$={key:0},ee=l("i",{class:"pi pi-check"},null,-1),te=l("div",null,[l("a",{href:"/finances/invoices",class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"},"Invoices")],-1);function ae(p,e,d,i,s,n){const r=_("TabPanel"),y=_("Chart"),P=_("Button"),k=_("InputText"),m=_("Column"),w=_("DataTable"),T=_("Payments"),S=_("TabView"),V=_("Container"),A=_("Layout");return c(),R(A,null,{header:o(()=>[O]),default:o(()=>[t(V,null,{default:o(()=>[t(S,null,{default:o(()=>[t(r,{header:"Revenue for year"},{default:o(()=>[(c(!0),u(v,null,g(n.revenue,h=>(c(),u("div",{key:h.name},[l("h2",E,f(h.name),1),(c(!0),u(v,null,g(h.aggregatedRevenue,(b,a)=>(c(),u("ul",{key:a},[l("li",null,f(a)+": "+f(n.moneyFormat(b)),1)]))),128))]))),128))]),_:1}),t(r,{header:"Paid/Unpaid"},{default:o(()=>[(c(!0),u(v,null,g(s.completedProposals,(h,b)=>(c(),u("div",{key:b,class:"card my-4"},[l("div",Y,[l("h5",null,f(h.name),1),t(y,{type:"line",data:h.data,options:s.basicOptions},null,8,["data","options"])])]))),128))]),_:1}),t(r,{header:"Unpaid Contracts"},{default:o(()=>[(c(!0),u(v,null,g(s.completedProposals,(h,b)=>(c(),u("div",{key:b,class:"card my-4"},[l("div",J,[l("h5",null,f(h.name),1),t(w,{filters:s.unpaidProposalFilter,"onUpdate:filters":e[2]||(e[2]=a=>s.unpaidProposalFilter=a),value:h.unpaid,"striped-rows":"","row-hover":"","responsive-layout":"scroll","selection-mode":"single",onRowClick:n.gotoPayments},{header:o(()=>[l("div",j,[t(P,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:e[0]||(e[0]=a=>n.initializedunPaidProposalFilter())}),l("span",K,[q,t(k,{modelValue:s.unpaidProposalFilter.global.value,"onUpdate:modelValue":e[1]||(e[1]=a=>s.unpaidProposalFilter.global.value=a),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:o(()=>[F(" No Records found. Click 'new' to create one. ")]),default:o(()=>[t(m,{field:"name",header:"Name",sortable:!0}),t(m,{field:"price",header:"Price",sortable:!0},{body:o(a=>[F(" $"+f(parseFloat(a.data.price).toFixed(2)),1)]),_:1}),t(m,{field:"amountPaid",header:"Paid",sortable:!0},{body:o(a=>[l("div",G,[l("div",H,f(a.data.amountPaid.replace(/,/g,""))+" / "+f(parseFloat(a.data.price).toFixed(2)),1),l("div",{class:"z-40 absolute top-0 left-0 h-full",style:z([{"min-width":"10px"},n.getStats(a.data.amountPaid,a.data.price)])},null,4)])]),_:1}),t(m,{field:"date",header:"Event Date",sortable:!0})]),_:2},1032,["filters","value","onRowClick"])])]))),128))]),_:1}),t(r,{header:"Paid Contracts"},{default:o(()=>[(c(!0),u(v,null,g(s.completedProposals,(h,b)=>(c(),u("div",{key:b,class:"card my-4"},[l("div",Q,[l("h5",null,f(h.name),1),t(w,{filters:s.paidProposalFilter,"onUpdate:filters":e[5]||(e[5]=a=>s.paidProposalFilter=a),value:h.paid,"striped-rows":"","row-hover":"","responsive-layout":"scroll","selection-mode":"single",onRowClick:n.gotoPayments},{header:o(()=>[l("div",W,[t(P,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:e[3]||(e[3]=a=>n.initializedPaidProposalFilter())}),l("span",X,[Z,t(k,{modelValue:s.paidProposalFilter.global.value,"onUpdate:modelValue":e[4]||(e[4]=a=>s.paidProposalFilter.global.value=a),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:o(()=>[F(" No Records found. Click 'new' to create one. ")]),default:o(()=>[t(m,{field:"name",header:"Name",sortable:!0}),t(m,{field:"price",header:"Price",sortable:!0},{body:o(a=>[F(" $"+f(parseFloat(a.data.price).toFixed(2)),1)]),_:1}),t(m,{field:"date",header:"Event Date",sortable:!0}),t(m,{field:"amountLeft",header:"Payment Overridden",sortable:!0},{body:o(a=>[a.data.amountLeft!=="0.00"&&a.data.paid?(c(),u("div",$,[ee,F(" Still Owed $"+f(a.data.amountLeft),1)])):D("",!0)]),_:1})]),_:2},1032,["filters","value","onRowClick"])])]))),128))]),_:1}),t(r,{header:"Invoices"},{default:o(()=>[te]),_:1}),t(r,{header:"Payments"},{default:o(()=>[l("div",null,[t(T)])]),_:1})]),_:1})]),_:1})]),_:1})}const le=N(L,[["render",ae]]);export{le as default};
