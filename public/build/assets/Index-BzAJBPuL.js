import{_ as B,B as D,S as F,U as N,a9 as U,s as L,u as A,h as x,a7 as z,r as u,o as t,c as f,w as d,e as a,a as p,f as k,t as n,b as s,F as v,k as y,d as i,n as H,i as g,aa as j,v as E,j as O}from"./app-BoR-OAMc.js";import{C as R}from"./CurrencyInput-dWMPoO4r.js";const K={components:{BreezeAuthenticatedLayout:D,DataTable:F,Column:N,InputText:U,InputSwitch:L,Button:A,CurrencyInput:R},props:["proposals","successMessage","eventTypes"],data(){return{showModal:!1,showInvoiceModal:!1,activeProposal:{},activeBandSite:"",filters1:null,showFields:[{name:"Invoices",property:"invoices",subProperty:"amount"},{name:"Author",property:"author",subProperty:"name"},{name:"Proposed Date/Time",property:"date"},{name:"Recurring dates",property:"recurring_dates",subProperty:"date"},{name:"Event Type",property:"event_type",subProperty:"name"},{name:"Location",property:"location"},{name:"Hours",property:"hours"},{name:"Price",property:"price"},{name:"Color",property:"color"},{name:"Locked",property:"locked"},{name:"Notes",property:"notes"},{name:"Created",property:"created_at"},{name:"Contract PDF",property:"contract",subProperty:"image_url"}],proposalData:{name:"",date:new Date(x().set({hour:19,minute:0}).add("month",1)),event_type_id:0,hours:0,price:0,notes:""},loading:!1,draftInputs:[{name:"Name",type:"text",field:"name",editable:!1},{name:"Agreed upon price",type:"formattedPrice",field:"price",editable:!1},{name:"Amount Paid",type:"formattedPrice",field:"amountPaid",editable:!1},{name:"Amount Owed",type:"formattedPrice",field:"amountLeft",editable:!1},{name:"Invoice Amount",type:"currency",field:"amount",editable:!0},{name:"Person to receive invoice",type:"contactDropdown",field:"contacts"},{name:"Buyer pays the 2.9% convenience fee",type:"toggle",field:"buyer_pays_convenience",note:"The payment processor Stripe has a default rate of 2.9% of every transaction plus $0.30. If you want to eat the cost yourself, leave this off. If you want to put the transaction fee on the buyer, enable this. For example, let's say you have an agreed performance price of $1000. Turning this off will give you a return of $970.70 ($1000 - (($1000 * 0.029) + 0.30)). Turning this on will give you a return of $1000, but the buyer will pay $1029.30 ($1000 + (($1000 * 0.029) + 0.30)).",editable:!0}]}},created(){this.initFilters1()},methods:{formatMoney(c){const r=c.toString().replace(/,/g,"");return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r)},toggleInvoiceModal(c){this.showInvoiceModal=!this.showInvoiceModal},createInvoice(c){c.buyer_pays_convenience=!0,this.activeProposal=c,this.showInvoiceModal=!0},sendInvoice(){this.$inertia.post("/finances/invoices/"+this.activeProposal.key+"/send",{amount:this.activeProposal.amount,contact_id:this.activeProposal.contact_id,buyer_pays_convenience:this.activeProposal.buyer_pays_convenience})},toggleModal(){this.showModal=!this.showModal},selectProposal(c){for(const r in c.data.invoices)c.data.invoices[r].created_at=x(c.data.invoices[r].created_at).format("LLLL");this.activeProposal=c.data,this.showModal=!0},gotoProposal(){this.$inertia.get("/proposals/"+this.activeProposal.key+"/edit")},writeToCalendar(){this.$inertia.post("/proposals/"+this.activeProposal.key+"/writeToCalendar")},clearFilter1(){this.initFilters1()},initFilters1(){this.filters1={global:{value:null,matchMode:z.CONTAINS}}}}},W=a("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Finances ",-1),q={class:"md:container md:mx-auto"},G={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},J={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg pt-4"},Q={class:"p-d-flex p-jc-between"},X={class:"p-input-icon-left"},Y=a("i",{class:"pi pi-search"},null,-1),Z={key:0,class:"flex justify-center items-center flex align-center content-center h-full flex-col"},$=a("div",{class:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"},null,-1),ee=a("div",{class:"my-8"}," Sending... ",-1),oe=[$,ee],te={key:1},ae={class:"text-gray-600"},se={for:"name"},re={key:0,class:"mb-4"},le={key:0},ne={key:1},ie={key:0},ce={key:1,class:"overflow-ellipsis text-blue-500"},de=["href"],pe=a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 inline",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z","clip-rule":"evenodd"})],-1),ue={key:2},me={key:3,class:"mb-4"},he={class:H(["md:grid","md:grid-cols-2","hover:bg-gray-50","md:space-y-0","space-y-1","p-4"])},ve=a("p",{class:"text-gray-600"},[a("label",{for:"name"},"Contacts")],-1);const ye=a("h1",null,"New Invoice",-1),_e={class:"text-gray-600"},fe=["for"],ge={key:0,class:"mb-4"},be=["id","onUpdate:modelValue","type","placeholder"],we=["id"],Pe={key:1},xe={key:2},ke={key:3},Ce=["onUpdate:modelValue"],Ie={key:4},Ve=["value"],Me={key:5},Se={key:6,class:"md:grid-cols-2"},Te={class:"text-gray-400 text-sm"};function Be(c,r,b,De,o,m){const w=u("Button"),C=u("InputText"),_=u("Column"),I=u("DataTable"),P=u("card-modal"),V=u("currency-input"),M=u("InputSwitch"),S=u("breeze-authenticated-layout");return t(),f(S,null,{header:d(()=>[W]),default:d(()=>[a("div",q,[a("div",G,[a("div",J,[p(I,{filters:o.filters1,"onUpdate:filters":r[2]||(r[2]=e=>o.filters1=e),value:b.proposals,"responsive-layout":"scroll","selection-mode":"single",paginator:!0,rows:10,"rows-per-page-options":[10,20,50],"global-filter-fields":["name","date","band.name"],"filter-display":"menu",onRowSelect:m.selectProposal},{header:d(()=>[a("div",Q,[p(w,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:r[0]||(r[0]=e=>m.clearFilter1())}),a("span",X,[Y,p(C,{modelValue:o.filters1.global.value,"onUpdate:modelValue":r[1]||(r[1]=e=>o.filters1.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:d(()=>[k(" No Completed Proposals. ")]),default:d(()=>[p(_,{field:"name","filter-field":"name",header:"Name",sortable:!0}),p(_,{field:"date","filter-field":"date",header:"Date",sortable:!0}),p(_,{field:"band.name","filter-field":"band.name",header:"Band",sortable:!0}),p(_,null,{body:d(e=>[p(w,{icon:"pi pi-dollar",label:"Create Invoice",onClick:l=>m.createInvoice(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","onRowSelect"])])])]),o.showModal?(t(),f(P,{key:0,ref:"proposalModal","show-save":!1,onClosing:r[4]||(r[4]=e=>m.toggleModal())},{header:d(()=>[a("h1",null,n(o.activeProposal.name),1)]),body:d(()=>[o.loading?(t(),s("div",Z,oe)):(t(),s("div",te,[(t(!0),s(v,null,y(o.showFields.filter(e=>Array.isArray(o.activeProposal[e.property])?o.activeProposal[e.property].length>0:o.activeProposal[e.property]),(e,l)=>(t(),s("div",{key:l,class:"md:grid md:grid-cols-2 hover:bg-gray-50 md:space-y-0 space-y-1 p-4 border-b"},[a("p",ae,[a("label",se,n(e.name),1)]),e.property=="invoices"?(t(),s("div",re,[o.activeProposal[e.property].length==0?(t(),s("div",le," No invoices have been sent. ")):(t(),s("ul",ne,[(t(!0),s(v,null,y(o.activeProposal[e.property],(h,T)=>(t(),s("li",{key:T},[a("div",null," $"+n(h.amount)+" - Sent "+n(h.created_at),1),a("div",null,"Status: "+n(h.status),1),h.status==="paid"?(t(),s("div",ie," Payment Date: "+n(h.updated_at),1)):i("",!0)]))),128))]))])):i("",!0),e.property=="contract"?(t(),s("div",ce,[a("a",{target:"_blank",href:o.activeProposal[e.property][e.subProperty],download:""},[pe,k(" Download Contract ")],8,de)])):e.property=="price"?(t(),s("div",ue," $"+n(parseFloat(o.activeProposal[e.property]).toFixed(2)),1)):(t(),s("div",me,n(e.subProperty?o.activeProposal[e.property][e.subProperty]:o.activeProposal[e.property]),1))]))),128)),a("div",he,[ve,a("div",null,[(t(!0),s(v,null,y(o.activeProposal.proposal_contacts,e=>(t(),s("ul",{key:e.id,class:"mb-4"},[a("li",null,"Name: "+n(e.name),1),a("li",null,"Phone: "+n(e.phonenumber),1),a("li",null,"Name: "+n(e.email),1)]))),128))])])]))]),footerBody:d(()=>[i("",!0)]),_:1},512)):i("",!0),o.showInvoiceModal?(t(),f(P,{key:1,ref:"proposalCreateInvoice","save-text":"Create Invoice","show-save":parseFloat(o.activeProposal.amountLeft)>=0,onSave:m.sendInvoice,onClosing:r[6]||(r[6]=e=>m.toggleInvoiceModal())},{header:d(()=>[ye]),body:d(()=>[(t(!0),s(v,null,y(o.draftInputs,e=>(t(),s("div",{key:e,class:"md:grid md:grid-cols-2 hover:bg-gray-50 md:space-y-0 space-y-1 p-4 border-b"},[a("p",_e,[a("label",{for:e.name},n(e.name),9,fe)]),["text","number"].indexOf(e.type)!==-1?(t(),s("div",ge,[e.editable?g((t(),s("input",{key:0,id:e.name,"onUpdate:modelValue":l=>o.activeProposal[e.field]=l,type:e.type,class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:e.name},null,8,be)),[[j,o.activeProposal[e.field]]]):(t(),s("span",{key:1,id:e.name,class:"appearance-none rounded w-full py-2 px-3 text-gray-700 leading-tight"},n(o.activeProposal[e.field]),9,we))])):i("",!0),e.type=="currency"?(t(),s("div",Pe,[p(V,{modelValue:o.activeProposal[e.field],"onUpdate:modelValue":l=>o.activeProposal[e.field]=l},null,8,["modelValue","onUpdate:modelValue"])])):i("",!0),e.type=="formattedPrice"?(t(),s("div",xe,n(m.formatMoney(o.activeProposal[e.field])),1)):i("",!0),e.type=="textArea"?(t(),s("div",ke,[g(a("textarea",{"onUpdate:modelValue":l=>o.activeProposal[e.field]=l,class:"min-w-full",placeholder:""},null,8,Ce),[[E,o.activeProposal[e.field]]])])):i("",!0),e.type=="contactDropdown"?(t(),s("div",Ie,[g(a("select",{id:"grid-state","onUpdate:modelValue":r[5]||(r[5]=l=>o.activeProposal.contact_id=l),class:"block appearance-none w-full bg-grey-lighter border border-grey-lighter text-grey-darker py-3 px-4 pr-8 rounded"},[(t(!0),s(v,null,y(o.activeProposal[e.field],l=>(t(),s("option",{key:l.id,value:l.id},n(l.name)+" - "+n(l.email),9,Ve))),128))],512),[[O,o.activeProposal.contact_id]])])):i("",!0),e.type=="toggle"?(t(),s("div",Me,[p(M,{modelValue:o.activeProposal[e.field],"onUpdate:modelValue":l=>o.activeProposal[e.field]=l},null,8,["modelValue","onUpdate:modelValue"])])):i("",!0),e.note?(t(),s("div",Se,[a("p",Te,n(e.note),1)])):i("",!0)]))),128))]),_:1},8,["show-save","onSave"])):i("",!0)]),_:1})}const Le=B(K,[["render",Be]]);export{Le as default};
