import{_ as P,B as z,h as D,ad as S,r as w,o as s,b as l,a as h,w as u,e as n,f as d,t as g,F as b,k,n as _,i as c,aa as E,d as i,v as y,g as x,c as V,j as R}from"./app-Dcv1srkc.js";import{B as M}from"./Button-Bs6yZ00n.js";import{C as A}from"./CurrencyInput-D5WofHzb.js";import{s as L,a as F}from"./VueTimepicker-BoWjdv4G.js";import{R as I}from"./ReservedCalendar-yNqTtyxq.js";import"./index-d2Ae9K3G.js";const j={components:{BreezeAuthenticatedLayout:z,Datepicker:L,VueTimepicker:F,ButtonComponent:M,CurrencyInput:A,ReservedCalendar:I},props:["proposal","eventTypes","bookedDates","proposedDates","recurringDates"],data(){return{proposalData:this.proposal,newContact:{name:"",phonenumber:"",email:""},unsavedChanges:!1,patchingContact:{},validInputs:[{name:"Name",type:"text",field:"name"},{name:"Event Type",type:"eventTypeDropdown",field:"event_type_id"},{name:"Date / Time",type:"date",field:"date"},{name:"Where",type:"location",field:"location_id"},{name:"Contacts",type:"contacts",field:"proposal_contacts"},{name:"Length (hours)",type:"number",field:"hours"},{name:"Price",type:"currency",field:"price"},{name:"Colorway",type:"text",field:"color"},{name:"Notes (for band)",type:"textArea",field:"notes"},{name:"Client Notes",type:"textArea",field:"client_notes"}],showCreateNewContact:!1,inputClass:["shadow","appearance-none","border","rounded ","w-full ","py-2 ","px-3 ","text-gray-700 ","leading-tight ","focus:outline-none ","focus:shadow-outline"],sessionToken:Math.floor(Math.random()*1e9),searchResults:"",searchTimer:null}},created(){this.proposalData.date=new Date(D(String(this.proposalData.date)));for(let r in this.recurringDates)this.recurringDates[r].date=new Date(D(String(this.recurringDates[r].date)))},methods:{saveContact(){this.$inertia.post("/proposals/createContact/"+this.proposal.key,this.newContact,{preserveScroll:!0,onSuccess:r=>{this.newContact.name="",this.newContact.phonenumber="",this.newContact.email="",this.showCreateNewContact=!1,this.proposalData.proposal_contacts=r.props.proposal.proposal_contacts}})},updateContact(r){this.$inertia.post("/proposals/editContact/"+r.id,r,{preserveScroll:!0}).then(()=>{r.editing=!1})},removeContact(r){this.$inertia.delete("/proposals/deleteContact/"+r.id,{preserveScroll:!0}).then(o=>{this.proposalData.proposal_contacts=this.proposalData.proposal_contacts.filter(f=>f.id!==r.id)})},hideContactEdits(){this.proposalData.proposal_contacts.forEach(r=>r.editing=!1)},updateProposal(){this.proposalData.recurring_dates=this.recurringDates,this.$inertia.patch("/proposals/"+this.proposal.key+"/update/",this.proposalData)},finalizeProposal(){this.unsavedChanges?this.$swal.fire({title:"You have unsaved changes",text:"Do you want to save changes and finalize or go as is?",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Save Changes and Finalize",denyButtonText:"Discard Changes and Finalize"}).then(r=>{r.isConfirmed?this.$inertia.patch("/proposals/"+this.proposal.key+"/update/",this.proposalData,{onSuccess:()=>{this.unsavedChanges=!1,this.finalizeProposal()}}):r.isDenied&&(this.unsavedChanges=!1,this.finalizeProposal())}):this.$inertia.post("/proposals/"+this.proposal.key+"/finalize/")},addRecurringDate(){this.recurringDates.push({date:new Date(D(String(this.proposalData.date)).add(this.recurringDates.length+1,"days"))})},deleteProposal(){this.$swal.fire({title:"Are you sure you want to delete the "+this.proposalData.name+"proposal?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(r=>{r.value&&this.$inertia.delete("/proposals/"+this.proposal.key+"/delete")})},autoComplete(){this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null),this.searchTimer=setTimeout(()=>{S.post("/autocompleteLocation",{sessionToken:this.sessionToken,searchParams:this.proposalData.location}).then(r=>{this.searchResults=r.data.predictions})},800)}}},Y={class:"font-semibold text-xl text-gray-800 leading-tight"},q={class:"min-w-full max-w-7xl mx-auto sm:px-6 lg:px-8"},H={class:"mb-4"},K={class:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"},O={class:"bg-white w-full rounded-lg shadow-xl"},W={class:"text-gray-600"},G=["for"],J={key:0,class:"mb-4"},Q=["id","onUpdate:modelValue","type","placeholder"],X={key:1,class:"mb-4"},Z={key:2,class:"mb-4"},$={class:""},ee=["onClick"],te={key:3},oe=["onClick"],se={key:0},ne={key:1},ae={key:2},le={key:3},re=["onUpdate:modelValue"],ie={key:4},pe=["onUpdate:modelValue"],de={key:5},ue=["onUpdate:modelValue"],ce={key:6},he={key:0},me=["onUpdate:modelValue"],ye={key:5},fe=["onClick"],Ce=n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),ge=[Ce],_e={key:6},ve=["onUpdate:modelValue"],we=["value"],be={class:"flex items-center justify-between"},ke=["disabled"];function De(r,o,f,xe,t,m){const T=w("Link"),N=w("currency-input"),C=w("button-component"),U=w("reserved-calendar"),B=w("breeze-authenticated-layout");return s(),l("div",null,[h(B,null,{header:u(()=>[n("h2",Y,[h(T,{href:"/proposals"},{default:u(()=>[d(" Proposals ")]),_:1}),d(" :: "+g(t.proposalData.name),1)])]),default:u(()=>[n("div",q,[n("div",H,[n("div",K,[n("div",O,[(s(!0),l(b,null,k(t.validInputs,a=>(s(),l("div",{key:a,class:"md:grid md:grid-cols-2 hover:bg-gray-50 md:space-y-0 space-y-1 p-4 border-b"},[n("p",W,[n("label",{for:a.name},g(a.name),9,G)]),["text","number"].indexOf(a.type)!==-1?(s(),l("div",J,[c(n("input",{id:a.name,"onUpdate:modelValue":e=>t.proposalData[a.field]=e,type:a.type,class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:a.name,onInput:o[0]||(o[0]=e=>t.unsavedChanges=!0)},null,40,Q),[[E,t.proposalData[a.field]]])])):i("",!0),a.type=="currency"?(s(),l("div",X,[h(N,{modelValue:t.proposalData[a.field],"onUpdate:modelValue":e=>t.proposalData[a.field]=e},null,8,["modelValue","onUpdate:modelValue"])])):i("",!0),a.type=="location"?(s(),l("div",Z,[c(n("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>t.proposalData.location=e),type:"text",class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",onInput:o[2]||(o[2]=e=>t.unsavedChanges=!0),onKeyup:o[3]||(o[3]=e=>m.autoComplete())},null,544),[[y,t.proposalData.location]]),n("ul",$,[(s(!0),l(b,null,k(t.searchResults,(e,p)=>(s(),l("li",{key:p,class:"border-black my-4 p-4 bg-gray-200 hover:bg-gray-300 cursor-pointer",onClick:v=>{t.proposalData.location=e.description,t.searchResults=null}},g(e.description),9,ee))),128))])])):i("",!0),a.type=="contacts"?(s(),l("div",te,[(s(!0),l(b,null,k(t.proposalData.proposal_contacts,e=>(s(),l("ul",{key:e.id,class:"hover:bg-gray-100 cursor-pointer",onClick:p=>{t.proposalData.proposal_contacts.forEach(v=>v.editing=!1),e.editing||(e.editing=!0)}},[e.editing?i("",!0):(s(),l("li",se," Name: "+g(e.name),1)),e.editing?i("",!0):(s(),l("li",ne," Phone: "+g(e.phonenumber),1)),e.editing?i("",!0):(s(),l("li",ae," Email: "+g(e.email),1)),e.editing?(s(),l("li",le,[d(" Name: "),c(n("input",{"onUpdate:modelValue":p=>e.name=p,class:_(t.inputClass),required:"",type:"text"},null,10,re),[[y,e.name]])])):i("",!0),e.editing?(s(),l("li",ie,[d(" Phone: "),c(n("input",{"onUpdate:modelValue":p=>e.phonenumber=p,class:_(t.inputClass),type:"tel"},null,10,pe),[[y,e.phonenumber]])])):i("",!0),e.editing?(s(),l("li",de,[d(" Email: "),c(n("input",{"onUpdate:modelValue":p=>e.email=p,class:_(t.inputClass),type:"email"},null,10,ue),[[y,e.email]])])):i("",!0),e.editing?(s(),l("li",ce,[h(C,{type:"button",onClick:x(p=>m.updateContact(e),["stop"])},{default:u(()=>[d(" Save ")]),_:2},1032,["onClick"]),h(C,{type:"button",onClick:x(p=>e.editing=!1,["stop"])},{default:u(()=>[d(" Cancel ")]),_:2},1032,["onClick"]),h(C,{type:"button",onClick:x(p=>m.removeContact(e),["stop"])},{default:u(()=>[d(" Delete ")]),_:2},1032,["onClick"])])):i("",!0)],8,oe))),128)),t.showCreateNewContact?(s(),l("ul",he,[n("li",null,[d(" Name: "),c(n("input",{"onUpdate:modelValue":o[4]||(o[4]=e=>t.newContact.name=e),class:_(t.inputClass),required:"",type:"text"},null,2),[[y,t.newContact.name]])]),n("li",null,[d(" Phone: "),c(n("input",{"onUpdate:modelValue":o[5]||(o[5]=e=>t.newContact.phonenumber=e),class:_(t.inputClass),type:"tel"},null,2),[[y,t.newContact.phonenumber]])]),n("li",null,[d(" Email: "),c(n("input",{"onUpdate:modelValue":o[6]||(o[6]=e=>t.newContact.email=e),class:_(t.inputClass),type:"email"},null,2),[[y,t.newContact.email]])])])):i("",!0),t.showCreateNewContact?i("",!0):(s(),V(C,{key:1,type:"button",onClick:o[7]||(o[7]=e=>t.showCreateNewContact=!0)},{default:u(()=>[d(" Create New ")]),_:1})),t.showCreateNewContact?(s(),V(C,{key:2,type:"button",onClick:o[8]||(o[8]=e=>t.showCreateNewContact=!1)},{default:u(()=>[d(" Cancel ")]),_:1})):i("",!0),t.showCreateNewContact?(s(),V(C,{key:3,type:"button",onClick:m.saveContact},{default:u(()=>[d(" Save ")]),_:1},8,["onClick"])):i("",!0)])):i("",!0),a.type=="textArea"?(s(),l("div",{key:4,onChange:o[9]||(o[9]=e=>t.unsavedChanges=!0)},[c(n("textarea",{"onUpdate:modelValue":e=>t.proposalData[a.field]=e,class:"min-w-full",placeholder:""},null,8,me),[[y,t.proposalData[a.field]]])],32)):i("",!0),a.type=="date"?(s(),l("div",ye,[h(U,{modelValue:t.proposalData[a.field],"onUpdate:modelValue":e=>t.proposalData[a.field]=e},null,8,["modelValue","onUpdate:modelValue"]),(s(!0),l(b,null,k(f.recurringDates,(e,p)=>(s(),l("div",{key:p},[h(U,{modelValue:f.recurringDates[p].date,"onUpdate:modelValue":v=>f.recurringDates[p].date=v},null,8,["modelValue","onUpdate:modelValue"]),n("button",{class:"transform translate-y-1 bg-red-500 text-white active:bg-purple-600 font-bold uppercase text-xs px-4 py-2 rounded shadow hover:shadow-md outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150",type:"button",onClick:v=>f.recurringDates.splice(p,1)},ge,8,fe)]))),128)),n("div",null,[h(C,{onClick:m.addRecurringDate},{default:u(()=>[d(" Add another date ")]),_:1},8,["onClick"])])])):i("",!0),a.type=="eventTypeDropdown"?(s(),l("div",_e,[c(n("select",{"onUpdate:modelValue":e=>t.proposalData[a.field]=e,onChange:o[10]||(o[10]=e=>t.unsavedChanges=!0)},[(s(!0),l(b,null,k(f.eventTypes,e=>(s(),l("option",{key:e.id,value:e.id},g(e.name),9,we))),128))],40,ve),[[R,t.proposalData[a.field]]])])):i("",!0)]))),128))]),n("div",be,[n("button",{class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"submit",onClick:o[11]||(o[11]=a=>m.updateProposal())}," Update Proposal "),n("button",{disabled:t.proposalData.proposal_contacts.length===0,class:_([{"bg-gray-400":t.proposalData.proposal_contacts.length===0,"cursor-not-allowed":t.proposalData.proposal_contacts.length===0,"bg-blue-500":t.proposalData.proposal_contacts.length!==0,"hover:bg-blue-700":t.proposalData.proposal_contacts.length!==0},"text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outlin"]),type:"button",onClick:o[12]||(o[12]=a=>m.finalizeProposal())}," Finalize ",10,ke),n("button",{class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"button",onClick:o[13]||(o[13]=a=>m.deleteProposal())}," Delete Proposal ")])])])])]),_:1})])}const ze=P(j,[["render",De]]);export{ze as default};
